 hex 7F01 constant via.porta 7F03 constant via.ddra : i2c-setup 0 via.porta c! 0 via.ddra c! ; : i2c-sda0 [ AD c, 03 c, 7f c, 09 c, 80 c, 8D c, 03 c, 7f c, ] ; allow-native : i2c-sda1 [ AD c, 03 c, 7f c, 29 c, 7F c, 8D c, 03 c, 7f c, ] ; allow-native : i2c-scl0 [ AD c, 03 c, 7f c, 09 c, 01 c, 8D c, 03 c, 7f c, ] ; allow-native : i2c-scl1 [ AD c, 03 c, 7f c, 29 c, FE c, 8D c, 03 c, 7f c, ] ; allow-native : i2c-clock i2c-scl1 i2c-scl0 ; allow-native : i2c-start i2c-sda1 i2c-scl1 i2c-sda0 i2c-scl0 ; allow-native : i2c-stop i2c-sda0 i2c-scl1 i2c-sda1 ; allow-native : i2c-txbit if i2c-sda1 else i2c-sda0 then i2c-clock ; : i2c-rxbit i2c-sda1 i2c-scl1 via.porta c@ 80 and if 1 else 0 then i2c-scl0 ; : i2c-tx 8 0 do dup 80 and i2c-txbit 2* loop drop i2c-rxbit ; : i2c-rx 0 8 0 do 2* i2c-rxbit + loop swap i2c-txbit ; : block2eeprom dup 40 < if 400 * A0 else 40 - 400 * A8 then ; : eeprom-pagewrite dup >r i2c-start i2c-tx drop 100 /mod i2c-tx drop i2c-tx drop 80 0 do dup i + c@ i2c-tx drop loop drop i2c-stop r> begin dup i2c-start i2c-tx 0= until drop i2c-stop ; : eeprom-blockwrite 8 0 do over i 80 * + over block2eeprom swap i 80 * + swap eeprom-pagewrite loop 2drop ; : eeprom-blockread block2eeprom dup i2c-start i2c-tx drop swap 100 /mod i2c-tx drop i2c-tx drop i2c-start 1+ i2c-tx drop 3FF 0 do 0 i2c-rx over i + c! loop 1 i2c-rx over 3FF + c! i2c-stop drop ; ' eeprom-blockread BLOCK-READ-VECTOR ! ' eeprom-blockwrite BLOCK-WRITE-VECTOR ! decimal 
